<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscaminas</title>
    <style>
        table {
            border-collapse: collapse;
            border: 2px solid #D1D1D1;
        }

        td {
            width: 22px;
            height: 22px;
            border: 1px solid #D1D1D1;
            text-align: center;
            vertical-align: middle;
            font-size: 17px;
            background-color: #EDEDED;
        }

        .expandida {
            background-color: #555;
        }

        .bomba-explotada {
            background-color: red;
            background-image: url('https://minesweeper.us/media/bomba.png');
            background-size: cover;
        }

        .bandera {
            background-image: url('https://cdn-icons-png.flaticon.com/512/1378/1378583.png');
            background-size: cover;
        }
    </style>
</head>
<body>

<script>
    let banderasColocadas = [];

    function crearTablero(filas, columnas, numBombas) {
        const tablero = document.getElementById('tablero');

        // Crear un array para representar el tablero
        const tableroArray = [];
        for (let i = 0; i < filas; i++) {
            tableroArray[i] = [];
            for (let j = 0; j < columnas; j++) {
                tableroArray[i][j] = { valor: 0, mostrado: false, bandera: false }; // Inicialmente ninguna celda está mostrada ni tiene bandera
            }
        }

        // Colocar bombas aleatoriamente
        let bombasColocadas = 0;
        while (bombasColocadas < numBombas) {
            const fila = Math.floor(Math.random() * filas);
            const columna = Math.floor(Math.random() * columnas);

            if (tableroArray[fila][columna].valor !== 9) {
                tableroArray[fila][columna].valor = 9; // 9 indica que hay una bomba en esta celda
                bombasColocadas++;
            }
        }

        // Calcular el número de bombas alrededor de cada celda
        for (let i = 0; i < filas; i++) {
            for (let j = 0; j < columnas; j++) {
                if (tableroArray[i][j].valor !== 9) {
                    let bombasCerca = 0;
                    // Verificar las celdas vecinas
                    for (let m = -1; m <= 1; m++) {
                        for (let n = -1; n <= 1; n++) {
                            const filaVecina = i + m;
                            const columnaVecina = j + n;
                            if (filaVecina >= 0 && filaVecina < filas && columnaVecina >= 0 && columnaVecina < columnas) {
                                if (tableroArray[filaVecina][columnaVecina].valor === 9) {
                                    bombasCerca++;
                                }
                            }
                        }
                    }
                    tableroArray[i][j].valor = bombasCerca;
                }
            }
        }

        // Generar el HTML del tablero
        for (let i = 0; i < filas; i++) {
            const filaElemento = document.createElement('tr');
            for (let j = 0; j < columnas; j++) {
                const celda = document.createElement('td');
                celda.dataset.fila = i;
                celda.dataset.columna = j;
                if (tableroArray[i][j].valor === 9) { // Si hay bomba en esta celda
                    celda.classList.add('bomba');
                    celda.addEventListener('click', function() {
                        mostrarCelda(tableroArray, i, j);
                        celda.classList.add('bomba-explotada');
                    });
                }
                celda.addEventListener('contextmenu', function(event) {
                    event.preventDefault();
                    toggleBandera(tableroArray, i, j);
                });
                filaElemento.appendChild(celda);
            }
            tablero.appendChild(filaElemento);
        }

        // Agregar eventos de clic a las celdas
        tablero.addEventListener('click', function(event) {
            const fila = parseInt(event.target.dataset.fila);
            const columna = parseInt(event.target.dataset.columna);
            if (!isNaN(fila) && !isNaN(columna) && !tableroArray[fila][columna].mostrado && !tableroArray[fila][columna].bandera) {
                mostrarCelda(tableroArray, fila, columna);
            }
        });
    }

    function mostrarCelda(tableroArray, fila, columna) {
        const celda = document.querySelector(`[data-fila="${fila}"][data-columna="${columna}"]`);
        if (!celda) return; // La celda no existe

        tableroArray[fila][columna].mostrado = true;

        if (tableroArray[fila][columna].valor === 0) {
            celda.textContent = '';
            celda.classList.add('expandida');
            for (let m = -1; m <= 1; m++) {
                for (let n = -1; n <= 1; n++) {
                    const filaVecina = fila + m;
                    const columnaVecina = columna + n;
                    if (filaVecina >= 0 && filaVecina < tableroArray.length && columnaVecina >= 0 && columnaVecina < tableroArray[0].length) {
                        if (!tableroArray[filaVecina][columnaVecina].mostrado && !tableroArray[filaVecina][columnaVecina].bandera) {
                            mostrarCelda(tableroArray, filaVecina, columnaVecina);
                        }
                    }
                }
            }
        } else if (tableroArray[fila][columna].valor === 9) {
            celda.classList.add('bomba-explotada');
        } else {
            celda.textContent = tableroArray[fila][columna].valor === 9 ? '' : tableroArray[fila][columna].valor;
        }
    }

    function toggleBandera(tableroArray, fila, columna) {
        const celda = document.querySelector(`[data-fila="${fila}"][data-columna="${columna}"]`);
        if (!celda) return; // La celda no existe

        if (!tableroArray[fila][columna].mostrado) {
            tableroArray[fila][columna].bandera = !tableroArray[fila][columna].bandera;
            if (tableroArray[fila][columna].bandera) {
                celda.classList.add('bandera');
                banderasColocadas.push({ fila, columna });
            } else {
                celda.classList.remove('bandera');
                banderasColocadas = banderasColocadas.filter(bandera => !(bandera.fila === fila && bandera.columna === columna));
            }
        }
    }

    function iniciarJuego() {
        const filas = prompt('Ingrese el número de filas y columnas:');
        const numFilas = parseInt(filas);
        const numBombas = Math.floor(numFilas * numFilas / 10); // 1 bomba por cada 10 casillas

        if (!isNaN(numFilas)) {
            crearTablero(numFilas, numFilas, numBombas);
        } else {
            alert('Por favor, ingrese un número válido de filas y columnas.');
        }
    }

    window.onload = iniciarJuego;
</script>

<table id="tablero"></table>

</body>
</html>
